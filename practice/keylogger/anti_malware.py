import psutil
import hashlib
import os
from datetime import datetime


class MalwareDetector:
    def __init__(self):
        self.suspicious_processes = ["cryptolocker", "wannacry", "keylogger"]
        self.known_malware_hashes = [
            "a94a8fe5ccb19ba61c4c0873d391e987982fbbd3",  # Contoh hash malware
        ]

    def scan_processes(self):
        """Memindai proses yang mencurigakan"""
        suspicious_found = []
        for proc in psutil.process_iter(["name", "pid"]):
            try:
                if any(
                    suspicious in proc.info["name"].lower()
                    for suspicious in self.suspicious_processes
                ):
                    suspicious_found.append(proc.info)
            except:
                continue
        return suspicious_found

    def check_file_integrity(self, file_path):
        """Memeriksa integritas file dengan hashing"""
        if not os.path.exists(file_path):
            return False

        with open(file_path, "rb") as f:
            file_hash = hashlib.sha1(f.read()).hexdigest()

        return file_hash in self.known_malware_hashes


# Contoh penggunaan
detector = MalwareDetector()
suspicious = detector.scan_processes()
if suspicious:
    print(f"Proses mencurigakan ditemukan: {suspicious}")
